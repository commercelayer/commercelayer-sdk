"use strict";var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(a,e,r,t,s){if(t==="m")throw new TypeError("Private method is not writable");if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?a!==e||!s:!e.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t==="a"?s.call(a,r):s?s.value=r:e.set(a,r),r},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(a,e,r,t){if(r==="a"&&!t)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?a!==e||!t:!e.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?t:r==="a"?t.call(a):t?t.value:e.get(a)},__importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}},_ResourceAdapter_client,_ResourceAdapter_config;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ApiResource=void 0;const client_1=__importDefault(require("./client")),jsonapi_1=require("./jsonapi"),query_1=require("./query"),config_1=__importDefault(require("./config")),debug_1=__importDefault(require("./debug")),debug=(0,debug_1.default)();class ListResponse extends Array{constructor(e,r){super(...r||[]);this.meta=e}first(){return this.length?this[0]:void 0}last(){return this.length?this[this.length-1]:void 0}get(e){return this.length&&e>=0?this[e]:void 0}}class ResourceAdapter{constructor(e){_ResourceAdapter_client.set(this,void 0),_ResourceAdapter_config.set(this,{}),__classPrivateFieldSet(this,_ResourceAdapter_client,client_1.default.create(e),"f"),this.localConfig(e)}get interceptors(){return __classPrivateFieldGet(this,_ResourceAdapter_client,"f").interceptors}localConfig(e){}config(e){debug("config %o",e),this.localConfig(e),__classPrivateFieldGet(this,_ResourceAdapter_client,"f").config(e)}async singleton(e,r,t){debug("singleton: %o, %O, %O",e,r||{},t||{});const s=(0,query_1.generateQueryStringParams)(r,e);(t==null?void 0:t.params)&&Object.assign(s,t==null?void 0:t.params);const i=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("get",`${e.type}`,void 0,Object.assign(Object.assign({},t),{params:s}));return(0,jsonapi_1.denormalize)(i)}async retrieve(e,r,t){debug("retrieve: %o, %O, %O",e,r||{},t||{});const s=(0,query_1.generateQueryStringParams)(r,e);(t==null?void 0:t.params)&&Object.assign(s,t==null?void 0:t.params);const i=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("get",`${e.type}/${e.id}`,void 0,Object.assign(Object.assign({},t),{params:s}));return(0,jsonapi_1.denormalize)(i)}async list(e,r,t){var s,i;debug("list: %o, %O, %O",e,r||{},t||{});const n=(0,query_1.generateQueryStringParams)(r,e);(t==null?void 0:t.params)&&Object.assign(n,t==null?void 0:t.params);const o=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("get",`${e.type}`,void 0,Object.assign(Object.assign({},t),{params:n})),c=(0,jsonapi_1.denormalize)(o),u={pageCount:Number((s=o.meta)===null||s===void 0?void 0:s.page_count),recordCount:Number((i=o.meta)===null||i===void 0?void 0:i.record_count),currentPage:(r==null?void 0:r.pageNumber)||config_1.default.default.pageNumber,recordsPerPage:(r==null?void 0:r.pageSize)||config_1.default.default.pageSize};return new ListResponse(u,c)}async create(e,r,t){debug("create: %o, %O, %O",e,r||{},t||{});const s=(0,query_1.generateQueryStringParams)(r,e);(t==null?void 0:t.params)&&Object.assign(s,t==null?void 0:t.params);const i=(0,jsonapi_1.normalize)(e),n=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("post",e.type,i,Object.assign(Object.assign({},t),{params:s}));return(0,jsonapi_1.denormalize)(n)}async update(e,r,t){debug("update: %o, %O, %O",e,r||{},t||{});const s=(0,query_1.generateQueryStringParams)(r,e);(t==null?void 0:t.params)&&Object.assign(s,t==null?void 0:t.params);const i=(0,jsonapi_1.normalize)(e),n=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("patch",`${e.type}/${e.id}`,i,Object.assign(Object.assign({},t),{params:s}));return(0,jsonapi_1.denormalize)(n)}async delete(e,r){debug("delete: %o, %O",e,r||{}),await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("delete",`${e.type}/${e.id}`,void 0,r)}}_ResourceAdapter_client=new WeakMap,_ResourceAdapter_config=new WeakMap;class ApiResource{constructor(e){debug("new resource instance: %s",this.type()),this.resources=e}}exports.ApiResource=ApiResource,exports.default=ResourceAdapter;